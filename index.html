<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriPro AI Decision Support Platform | Multilingual Farming Solutions</title>
    <link rel="icon" href="favicon.ico">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Embedded CSS demonstrating the full curriculum -->
    <style>
        /* ----------------------- üåª Modern CSS: Variables and Units ----------------------- */
        :root {
            --color-primary: #00FFFF; /* Neon Cyan (Success/Data) */
            --color-secondary: #00FF7F; /* Neon Spring Green (Neutral/Good) */
            --color-accent: #FF00FF; /* Neon Magenta (CTA/Critical) */
            --color-warning: #FFA500; /* Neon Orange (Warning) */
            --color-bg-dark: #0d1117; 
            --color-card-bg: rgba(255, 255, 255, 0.05); 
            --color-text: #E0E0E0;
            --box-shadow-neon: 0 0 15px rgba(0, 255, 255, 0.4), 0 0 5px rgba(0, 255, 255, 0.1);
            --header-height: 4.5rem; 
            --padding-section: clamp(30px, 5vh, 80px); /* CSS Function: clamp() */
        }
        
        /* ----------------------- üåæ Basic CSS: Reset, Fonts, and Colors ----------------------- */
        body {
            font-family: 'Inter', monospace; /* Monospace for tech look */
            margin: 0;
            padding: 0;
            background-color: var(--color-bg-dark);
            color: var(--color-text);
            line-height: 1.6;
            overflow-x: hidden;
            font-size: 100%;
            /* scroll-snap-type removed */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1, h2, h3 {
            color: var(--color-primary);
            font-weight: 900;
            text-shadow: 0 0 5px var(--color-primary); 
        }
        
        /* ----------------------- Canvas and Overlay Positioning (Simplified) ----------------------- */
        #overlay-content {
            z-index: 5; 
        }

        /* ----------------------- üåæ Intermediate: Fixed Header and Flexbox ----------------------- */
        header {
            background-color: rgba(0, 0, 0, 0.85); 
            height: var(--header-height);
            display: flex; 
            align-items: center;
            justify-content: space-between; /* Adjusted for navigation */
            position: fixed; 
            top: 0;
            left: 0;
            width: 100vw; 
            z-index: 10; 
            border-bottom: 2px solid var(--color-secondary); 
            box-shadow: 0 2px 15px rgba(0, 255, 255, 0.4);
        }

        .logo-content {
            display: flex;
            align-items: center;
            padding: 0 20px;
        }

        .logo-text {
            font-size: 1.5em; 
            font-weight: 900;
            color: var(--color-primary);
            margin-left: 10px;
            text-shadow: 0 0 5px var(--color-primary);
        }
        
        /* Navigation (Multipage Simulation) */
        nav {
            padding-right: 20px;
        }
        nav a {
            color: var(--color-text);
            text-decoration: none;
            margin: 0 10px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s;
            font-size: 0.9em;
            font-weight: bold;
        }
        nav a:hover, nav a.active {
            color: var(--color-bg-dark);
            background-color: var(--color-secondary);
            text-shadow: none;
        }

        /* ----------------------- ADVANCED: Loading Screen (Pseudo-Elements & Animation) ----------------------- */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-bg-dark);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--color-primary);
            transition: opacity 0.5s ease-out; /* Reduced delay */
        }

        .spinner {
            width: 60px; 
            height: 60px;
            border: 5px solid rgba(0, 255, 255, 0.3);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 0.8s infinite linear; 
            position: relative;
        }

        .spinner::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 3px solid rgba(255, 0, 255, 0.1);
            border-bottom-color: var(--color-accent);
            border-radius: 50%;
            animation: spin-reverse 1.8s infinite linear;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes spin-reverse {
            to { transform: rotate(-360deg); }
        }

        /* ----------------------- üåæ Layout: CSS Grid Layout ----------------------- */
        .content-grid {
            display: grid; 
            gap: 40px;
            padding: var(--padding-section) 0;
            grid-template-columns: 1fr; 
        }
        
        @media (min-width: 900px) {
            .content-grid {
                grid-template-columns: 2fr 1fr; 
            }
        }
        
        /* ----------------------- üåæ Intermediate: Card Styling ----------------------- */
        .page-content, section {
            padding: 40px; 
            background-color: var(--color-card-bg);
            border-radius: 12px;
            border: 1px solid var(--color-primary);
            box-shadow: var(--box-shadow-neon); 
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            overflow: hidden; 
        }
        
        .card:hover {
            transform: scale(1.01); 
            box-shadow: 0 0 30px var(--color-secondary), 0 0 15px var(--color-secondary);
        }

        section h2::before {
            content: ">> "; 
            color: var(--color-accent);
            font-size: 1.1em;
            margin-right: 8px;
            font-weight: 900;
        }

        /* Input Group Styling */
        .input-group label, .input-group input {
            display: block;
            margin-bottom: 5px;
            color: var(--color-text);
            font-size: 0.9em;
        }
        .npk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        input[type="number"], button {
            padding: 10px;
            border: 1px solid var(--color-primary);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.5);
            color: var(--color-text);
            box-sizing: border-box;
            font-family: 'Inter', monospace;
            transition: all 0.3s;
        }
        input:focus {
            outline: none;
            border-color: var(--color-secondary);
            box-shadow: 0 0 8px var(--color-secondary);
        }
        
        /* ----------------------- üåæ Intermediate: Animation (CTA Button) ----------------------- */
        #suggest-button, .module-button {
            background-color: var(--color-accent);
            color: var(--color-bg-dark);
            font-weight: bold;
            border: 2px solid var(--color-secondary);
            box-shadow: 0 0 15px var(--color-accent);
            animation: pulse-cta 1.5s infinite; 
            cursor: pointer;
        }

        @keyframes pulse-cta {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 0, 255, 0.5); }
            70% { transform: scale(1.03); box-shadow: 0 0 0 20px rgba(255, 0, 255, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 0, 255, 0); }
        }
        
        /* ----------------------- ADVANCED: CSS Gauge and Transformations ----------------------- */
        .gauge-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            text-align: center;
        }

        .gauge-ring {
            width: 150px;
            height: 75px;
            border-radius: 75px 75px 0 0;
            background: conic-gradient(var(--color-secondary) 0%, var(--color-secondary) 0%, transparent 0%);
            overflow: hidden;
            position: relative;
            margin-bottom: -5px;
            border-top: 3px solid rgba(0, 255, 127, 0.5);
            transition: all 1s ease-out; /* Transitions */
        }

        .gauge-inner-circle {
            width: 120px;
            height: 60px;
            background: var(--color-bg-dark);
            border-radius: 60px 60px 0 0;
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 2;
        }

        .gauge-label {
            position: absolute;
            width: 100%;
            bottom: 0;
            left: 0;
            font-size: 1.5em;
            font-weight: bold;
            color: var(--color-primary);
            z-index: 3;
            text-shadow: var(--box-shadow-neon);
        }
        
        /* ----------------------- ADVANCED: Terminal Look ----------------------- */
        #live-data {
            height: 300px;
            background: #000;
            border: 1px solid var(--color-secondary);
            overflow-y: scroll; /* Overflow */
            padding: 15px;
            font-size: 0.9em;
            white-space: pre-wrap;
            box-shadow: 0 0 10px rgba(0, 255, 127, 0.4);
            margin-top: 15px;
        }

        .terminal-line {
            line-height: 1.4;
            color: var(--color-text);
            text-shadow: 0 0 2px rgba(0, 255, 127, 0.5);
            transition: opacity 0.3s;
        }
        .terminal-line.success { color: var(--color-secondary); }
        .terminal-line.command { color: var(--color-primary); }
        .terminal-line.critical { color: var(--color-accent); animation: critical-flash 0.5s infinite alternate; }

        @keyframes critical-flash {
            from { opacity: 1; }
            to { opacity: 0.5; }
        }
        
        /* ----------------------- MULTIPAGE STYLES ----------------------- */
        .page-module {
            display: none; /* Controlled by JS routing */
            min-height: calc(100vh - var(--header-height) - 40px);
            padding: 0 20px;
            align-items: center; /* Center content vertically */
        }
        .page-module.active {
            display: flex;
        }
        
        /* Pest and Market Modules */
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            width: 100%;
        }

        .market-item {
            padding: 15px;
            background: rgba(0, 255, 255, 0.05);
            border-left: 5px solid var(--color-primary);
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .market-price {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--color-secondary);
            text-shadow: 0 0 5px var(--color-secondary);
        }
        
        /* Chat/Voice Module */
        #chat-window {
            height: 400px;
            overflow-y: scroll;
            padding: 15px;
            background: #000;
            border: 1px solid var(--color-primary);
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow-neon);
        }
        .chat-message {
            margin-bottom: 10px;
            line-height: 1.4;
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 15px;
            clear: both;
        }
        .user-msg {
            background: var(--color-primary);
            color: var(--color-bg-dark);
            float: right;
            border-bottom-right-radius: 2px;
        }
        .ai-msg {
            background: var(--color-secondary);
            color: var(--color-bg-dark);
            float: left;
            border-bottom-left-radius: 2px;
        }
        #chat-input-container {
            display: flex;
            gap: 10px;
        }
        #chat-input-container input {
            flex-grow: 1;
        }
        #voice-button {
            background-color: var(--color-accent);
            color: var(--color-bg-dark);
            font-size: 1.2em;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        /* ----------------------- FOOTER ----------------------- */
        footer {
            background-color: #000000;
            padding: 20px 0;
            text-align: center;
            border-top: 1px solid var(--color-primary);
            margin-top: 40px;
        }
        
        /* Media Queries for Mobile Responsiveness */
        @media (max-width: 600px) {
            header {
                flex-direction: column;
                height: auto;
                padding-bottom: 10px;
            }
            .logo-content {
                padding: 10px 20px;
            }
            nav {
                width: 100%;
                text-align: center;
                padding: 10px 0 0;
            }
            nav a {
                display: inline-block;
                margin: 5px 5px;
            }
            .page-module {
                min-height: auto;
                padding-top: calc(var(--header-height) + 50px); 
                padding-bottom: 50px;
            }
            .content-grid, .module-grid {
                grid-template-columns: 1fr;
            }
            .page-module {
                flex-direction: column;
            }
        }

    </style>
</head>
<body>
    
    <!-- ----------------------- ADVANCED: Loading Screen ----------------------- -->
    <!-- Retained for quick, dramatic intro -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p style="margin-top: 20px; font-size: 1.8em; text-shadow: 0 0 15px var(--color-primary);">INITIATING CORE PROTOCOLS... Standby.</p>
    </div>

    <!-- ----------------------- OVERLAY CONTENT (Now the main visible area) ----------------------- -->
    <div id="overlay-content">
        
        <!-- ----------------------- MAIN HEADER & NAVIGATION ----------------------- -->
        <header>
            <div class="logo-content">
                <div class="emblem-placeholder" style="font-size: 2.2em; color: var(--color-secondary);">
                    <i class="fas fa-seedling"></i> 
                </div>
                <div class="logo-text">
                    AGRIPRO AI PLATFORM
                    <small style="display: block; font-size: 0.5em; font-weight: 600; color: var(--color-accent); text-shadow: none;">DECISION SUPPORT SYSTEM</small>
                </div>
            </div>
            <nav>
                <a href="#home" class="nav-link active" onclick="navigate('home')"><i class="fas fa-home"></i> Home</a>
                <a href="#advisory" class="nav-link" onclick="navigate('advisory')"><i class="fas fa-chart-line"></i> Advisory</a>
                <a href="#pest" class="nav-link" onclick="navigate('pest')"><i class="fas fa-bug"></i> Pest ID</a>
                <a href="#market" class="nav-link" onclick="navigate('market')"><i class="fas fa-cloud-sun-rain"></i> Market/Weather</a>
                <a href="#chat" class="nav-link" onclick="navigate('chat')"><i class="fas fa-headset"></i> Voice Chat</a>
            </nav>
        </header>

        <!-- ----------------------- VIRTUAL PAGES (Simulated Routing) ----------------------- -->
        
        <!-- HOME PAGE -->
        <div id="page-home" class="page-module active">
            <div class="container" style="text-align: center; max-width: 800px;">
                <h1><span style="color: var(--color-accent);">BIOLOGICALLY</span> ACCURATE. <span style="color: var(--color-accent);">FINANCIALLY</span> OPTIMAL.</h1>
                <h2>The Unified AI-Driven Decision Support System for Sustainable Agriculture.</h2>
                <p style="color: var(--color-text); margin-top: 20px; font-size: 1.1em;">
                    Our platform integrates real-time satellite and IoT data with advanced machine learning models to provide customized, science-guided advice, ensuring productivity increases of **10% or more**.
                </p>
                <button onclick="navigate('advisory')" class="module-button" style="padding: 15px 30px; margin-top: 30px; font-size: 1.2em; animation: pulse-cta 2s infinite;">
                    START DIAGNOSTICS <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- 1. SOIL & CROP ADVISORY MODULE -->
        <div id="page-advisory" class="page-module">
            <div class="container content-grid">
                <!-- Main Analysis Card (2/3 width on desktop) -->
                <section id="crop-scout-tool" class="card">
                    <h2 style="text-align: center;"><i class="fas fa-chart-line"></i> Soil & Crop Suitability Analysis</h2>
                    <p style="text-align: center; color: var(--color-text); max-width: 700px; margin: 10px auto 30px;">
                        Input your lab-tested soil data. Our **AI Neural Network** processes the profile to deliver hyper-specific, yield-optimized crop recommendations.
                    </p>

                    <div id="input-form">
                        <div class="npk-grid">
                            <div class="input-group">
                                <label for="nitrogen"><i class="fas fa-water" style="color: var(--color-primary);"></i> N (Nitrogen) kg/ha</label>
                                <input type="number" id="nitrogen" value="50" min="0" required>
                            </div>
                            <div class="input-group">
                                <label for="phosphorus"><i class="fas fa-sun" style="color: var(--color-primary);"></i> P (Phosphorus) kg/ha</label>
                                <input type="number" id="phosphorus" value="30" min="0" required>
                            </div>
                            <div class="input-group">
                                <label for="potassium"><i class="fas fa-fire" style="color: var(--color-primary);"></i> K (Potassium) kg/ha</label>
                                <input type="number" id="potassium" value="25" min="0" required>
                            </div>
                            <div class="input-group">
                                <label for="ph"><i class="fas fa-tint" style="color: var(--color-primary);"></i> pH Level</label>
                                <input type="number" id="ph" value="6.5" step="0.1" min="4" max="8" required>
                            </div>
                        </div>
                        
                        <button id="suggest-button" onclick="suggestCrop()" style="width: 100%; display: block; padding: 16px 30px; margin-top: 30px; cursor: pointer;">
                            <i class="fas fa-brain"></i> ANALYZE SOIL DATA & GENERATE REPORT
                        </button>
                    </div>

                    <div id="suggestion-results" style="padding: 0;">
                        <p class="result-title" style="margin-top: 40px; color: var(--color-secondary);"><i class="fas fa-seedling"></i> Personalized Crop Recommendations</p>
                        <div class="compatibility-note">Click 'ANALYZE SOIL DATA...' to view your diagnostic report and suggested crops.</div>
                    </div>
                </section>

                <!-- Sidebar / Advanced Diagnostics Card (1/3 width on desktop) -->
                <section class="card" style="align-self: start;">
                    <h2><i class="fas fa-tachometer-alt"></i> Diagnostic Console</h2>
                    
                    <!-- Advanced CSS Gauge -->
                    <div class="gauge-container">
                        <div class="gauge-ring">
                            <div class="gauge-inner-circle"></div>
                            <div id="gauge-label" class="gauge-label">0%</div>
                        </div>
                        <p style="margin-top: 10px; font-weight: bold; color: var(--color-secondary);">Soil Suitability Score</p>
                    </div>

                    <h2 style="margin-top: 30px;"><i class="fas fa-code"></i> Live Terminal Feed</h2>
                    <div id="live-data">
                        <!-- Terminal feed lines injected by JS -->
                    </div>

                    <div class="compatibility-note" style="border-top: 1px solid var(--color-primary); padding-top: 15px; margin-top: 15px;">
                        <p style="color: var(--color-primary); margin: 0;">AI Model: DNM v4.2 Secured.</p>
                        <a href="#" style="color: var(--color-accent); text-decoration: none; font-weight: bold;">[ACCESS KNOWLEDGE BASE]</a>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- 2. PEST & DISEASE DETECTION MODULE -->
        <div id="page-pest" class="page-module">
            <div class="container page-content" style="max-width: 900px; text-align: center;">
                <h2><i class="fas fa-camera"></i> Pest & Disease Imaging Center</h2>
                <p style="color: var(--color-text); margin-bottom: 30px;">
                    Upload an image of your affected crop leaf or stem. Our Vision AI model (CVN-1) will immediately identify the pathogen, its severity, and provide recommended treatments.
                </p>

                <div class="module-grid" style="grid-template-columns: 1fr 1fr;">
                    <div style="border: 2px dashed var(--color-secondary); padding: 30px; border-radius: 10px;">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 3em; color: var(--color-primary);"></i>
                        <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="processImage()">
                        <button class="module-button" onclick="document.getElementById('image-upload').click()" style="margin-top: 20px;">
                            UPLOAD CROP IMAGE
                        </button>
                        <p style="font-size: 0.8em; color: var(--color-secondary); margin-top: 10px;">Max 5MB (PNG/JPG)</p>
                    </div>
                    
                    <div id="detection-results" style="text-align: left; padding: 20px; border: 1px solid var(--color-accent);">
                        <p style="color: var(--color-warning);">**DETECTION LOG**</p>
                        <p id="log-status">Awaiting image upload...</p>
                        <p style="margin-top: 20px;">**SEVERITY:** <span id="log-severity" style="color: var(--color-text);">N/A</span></p>
                        <p>**TREATMENT:** <span id="log-treatment" style="color: var(--color-text);">N/A</span></p>
                    </div>
                </div>
                
                <p style="font-size: 0.9em; margin-top: 30px; color: var(--color-accent);">Disclaimer: Treat diagnosis as advisory. Always confirm severe cases.</p>
            </div>
        </div>

        <!-- 3. MARKET & WEATHER INSIGHTS MODULE -->
        <div id="page-market" class="page-module">
            <div class="container page-content">
                <h2><i class="fas fa-money-bill-wave"></i> Market & Predictive Insights</h2>
                <p style="color: var(--color-text); margin-bottom: 30px;">
                    Real-time tracking of futures, current market prices, and 7-day weather forecasts integrated with sustainability metrics.
                </p>

                <div class="module-grid">
                    <section class="card" style="grid-column: span 2;">
                        <h3>Weather and Yield Prediction</h3>
                        <div class="module-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                            <div class="market-item">
                                <i class="fas fa-thermometer-half"></i> **Current Temp (Location)**
                                <div class="market-price">28¬∞C / 82¬∞F</div>
                            </div>
                            <div class="market-item">
                                <i class="fas fa-cloud-sun-rain"></i> **7-Day Rainfall Forecast**
                                <div class="market-price">Low (0.5 mm)</div>
                            </div>
                            <div class="market-item">
                                <i class="fas fa-calculator"></i> **Predicted Yield Deviation**
                                <div class="market-price" style="color: var(--color-secondary);">+11.2% (Maize)</div>
                            </div>
                        </div>
                    </section>
                    
                    <section class="card">
                        <h3>Commodity Price Tracker (Simulated)</h3>
                        <div class="market-item">
                            **Wheat (Futures)**
                            <div class="market-price">$3.50 / kg <span style="font-size: 0.7em; color: var(--color-secondary);">+1.2%</span></div>
                        </div>
                        <div class="market-item">
                            **Tomato (Local)**
                            <div class="market-price">$0.85 / kg <span style="font-size: 0.7em; color: var(--color-accent);">-0.5%</span></div>
                        </div>
                    </section>
                    
                    <section class="card">
                        <h3>Sustainability Score</h3>
                        <div class="gauge-container" style="margin-top: 0;">
                            <div class="gauge-ring" style="width: 100px; height: 50px;">
                                <div class="gauge-inner-circle" style="width: 80px; height: 40px; top: 10px; left: 10px;"></div>
                                <div class="gauge-label" id="sustainability-score" style="font-size: 1.2em;">85%</div>
                            </div>
                            <p style="margin-top: 5px; font-weight: bold; color: var(--color-secondary);">Resource Efficiency</p>
                        </div>
                        <p style="font-size: 0.8em; text-align: center; margin-top: 10px;">Based on fertilizer/irrigation optimization.</p>
                    </section>
                </div>
            </div>
        </div>

        <!-- 4. MULTILINGUAL VOICE CHAT MODULE -->
        <div id="page-chat" class="page-module">
            <div class="container page-content" style="max-width: 600px;">
                <h2><i class="fas fa-comments"></i> Multilingual AI Advisory</h2>
                <p style="color: var(--color-text); margin-bottom: 20px;">
                    Ask questions in your local language (chat or voice). Our model provides actionable guidance instantly.
                </p>

                <div id="chat-window">
                    <div class="chat-message ai-msg">
                        Welcome! I am Agri-Bot. How may I assist you with your farming today? (English, Hindi, Telugu supported.)
                    </div>
                </div>

                <div id="chat-input-container">
                    <input type="text" id="user-input" placeholder="Type your question or query here...">
                    <button id="send-button" onclick="sendMessage()" class="module-button" style="width: auto; padding: 10px 15px;">Send</button>
                    <button id="voice-button" class="module-button" onclick="simulateVoiceInput()"><i class="fas fa-microphone"></i></button>
                </div>
            </div>
        </div>

        <!-- ----------------------- FOOTER ----------------------- -->
        <footer>
            <p style="color: var(--color-text); margin: 0;">Powered by AgriPro AI Platform. &copy; 2024</p>
        </footer>
    </div>

    <!-- Embedded JavaScript for Core Logic -->
    <script>
        
        // =================================================================
        // MULTI-PAGE NAVIGATION LOGIC
        // =================================================================
        function navigate(pageId) {
            document.querySelectorAll('.page-module').forEach(page => {
                page.classList.remove('active');
            });
            
            const targetPage = document.getElementById('page-' + pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                
                // Update active link class
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`a[href="#${pageId}"]`).classList.add('active');
                
                // Scroll to top of content area smoothly
                document.getElementById('overlay-content').scrollIntoView({ behavior: 'smooth' });
                
                // Update URL hash
                history.pushState(null, null, `#${pageId}`);
            }
        }

        function handleNavigation() {
            const hash = window.location.hash.replace('#', '');
            const defaultPage = 'home';
            const pageId = (hash && document.getElementById('page-' + hash)) ? hash : defaultPage;
            navigate(pageId);
        }

        window.addEventListener('hashchange', handleNavigation);
        window.addEventListener('load', handleNavigation);


        // =================================================================
        // ADVANCED JS/CSS INTEGRATION: TERMINAL AND GAUGE
        // =================================================================
        
        const terminalLog = document.getElementById('live-data');
        const terminalMessages = [
            { text: "DNM_v4.2: Initializing Neural Core...", class: "command" },
            { text: "[STATUS]: Satellite data link established.", class: "success" },
            { text: "System Online. Waiting for user input...", class: "success" },
            { text: "[FEED]: Global nutrient variance 1.7%", class: "" },
            { text: "[ALERT]: Critical soil health anomaly detected in Sector 7. Manual review required.", class: "critical" },
            { text: "[FEED]: Active monitoring cycle: 45 minutes.", class: "" },
        ];
        let terminalIndex = 0;

        function startTerminalFeed() {
            setInterval(() => {
                if (terminalIndex >= terminalMessages.length) {
                    terminalIndex = 0; 
                    terminalLog.innerHTML = `<span class="terminal-line success">--- REBOOTING LOG ---</span>`;
                }
                const msg = terminalMessages[terminalIndex];
                terminalLog.innerHTML += `<div class="terminal-line ${msg.class}">${msg.text}</div>`;
                terminalLog.scrollTop = terminalLog.scrollHeight; 
                terminalIndex++;
            }, 3000);
        }

        function updateGauge(score) {
            const percent = (score / 4) * 100;
            const angle = (percent / 100) * 180;
            const ring = document.querySelector('.gauge-ring');
            const label = document.getElementById('gauge-label');
            
            let color;
            if (percent >= 75) { color = "var(--color-secondary)"; }
            else if (percent >= 50) { color = "var(--color-primary)"; }
            else { color = "var(--color-accent)"; }

            // CSS Transformations via JS to update the gauge ring fill
            ring.style.background = `conic-gradient(${color} ${angle}deg, rgba(255, 255, 255, 0.1) ${angle}deg)`;
            label.textContent = `${Math.round(percent)}%`;
            label.style.color = color;
        }


        // =================================================================
        // CORE JS LOGIC (NPK Solver)
        // =================================================================
        const cropRequirements = [
            { crop: "Wheat (Triticum aestivum)", N: [60, 100], P: [20, 40], K: [25, 50], pH: [6.0, 7.5] },
            { crop: "Maize (Zea mays)", N: [80, 120], P: [30, 60], K: [40, 80], pH: [5.8, 7.0] },
            { crop: "Soybean (Glycine max)", N: [20, 40], P: [15, 30], K: [30, 60], pH: [6.0, 7.0] },
            { crop: "Rice (Oryza sativa)", N: [90, 140], P: [30, 50], K: [50, 100], pH: [5.0, 6.5] },
            { crop: "Potato (Solanum tuberosum)", N: [100, 150], P: [40, 70], K: [70, 120], pH: [5.0, 6.0] },
            { crop: "Tomato (Solanum lycopersicum)", N: [70, 110], P: [30, 50], K: [60, 90], pH: [6.0, 6.8] },
            { crop: "Spinach (Spinacia oleracea)", N: [40, 80], P: [20, 40], K: [40, 70], pH: [6.0, 7.5] },
            { crop: "Carrot (Daucus carota)", N: [30, 60], P: [15, 30], K: [40, 80], pH: [6.0, 7.0] },
            { crop: "Alfalfa (Medicago sativa)", N: [10, 30], P: [20, 50], K: [50, 100], pH: [6.5, 7.5] },
            { crop: "Sunflower (Helianthus annuus)", N: [50, 90], P: [25, 45], K: [50, 90], pH: [6.0, 7.5] },
            { crop: "Coffee (Coffea arabica)", N: [100, 150], P: [15, 30], K: [90, 130], pH: [5.0, 6.0] },
            { crop: "Grape (Vitis vinifera)", N: [30, 60], P: [10, 25], K: [50, 100], pH: [6.0, 7.0] }
        ];

        function isCompatible(inputVal, requiredRange) {
            return inputVal >= requiredRange[0] && inputVal <= requiredRange[1];
        }
        
        function calculateCompatibility(cropData, soilInputs) {
            let score = 0;
            const metrics = ['N', 'P', 'K', 'pH'];

            metrics.forEach(metric => {
                if (isCompatible(soilInputs[metric], cropData[metric])) {
                    score += 1; 
                }
            });
            return score;
        }

        function suggestCrop() {
            const N = parseFloat(document.getElementById('nitrogen').value);
            const P = parseFloat(document.getElementById('phosphorus').value);
            const K = parseFloat(document.getElementById('potassium').value);
            const pH = parseFloat(document.getElementById('ph').value);
            const resultsDiv = document.getElementById('suggestion-results');

            if (isNaN(N) || isNaN(P) || isNaN(K) || isNaN(pH)) {
                 resultsDiv.innerHTML = `<p class="result-title" style="color: var(--color-accent); text-shadow: none;"><i class="fas fa-exclamation-triangle"></i> Data Integrity Alert</p>
                    <div class="compatibility-note" style="color: var(--color-text); font-weight: bold;">Input Error: Ensure all fields contain valid numerical data.</div>`;
                return;
            }

            const soilInputs = { N, P, K, pH };
            
            const matchedCrops = cropRequirements.map(cropData => {
                const score = calculateCompatibility(cropData, soilInputs);
                return { 
                    crop: cropData.crop, 
                    score: score,
                    npkRange: { N: cropData.N, P: cropData.P, K: cropData.K, pH: cropData.pH }
                };
            }).filter(item => item.score > 0)
              .sort((a, b) => b.score - a.score);

            let resultsHTML = '';
            let maxScore = 0;

            if (matchedCrops.length > 0) {
                maxScore = matchedCrops[0].score;
                const bestMatches = matchedCrops.filter(item => item.score === maxScore);
                const compatibleMatches = matchedCrops.filter(item => item.score < maxScore && item.score >= 2);

                
                resultsHTML += `<p class="result-title" style="color: var(--color-secondary);"><i class="fas fa-check-circle"></i> Highest Confidence Recommendations (Score: ${maxScore}/4)</p>`;
                resultsHTML += `<ul class="crop-list" style="list-style: none; padding: 0;">`;
                
                bestMatches.forEach(item => {
                    resultsHTML += `<li class="crop-item" style="border-left-color: var(--color-accent); padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 0 5px rgba(0, 255, 255, 0.5);">
                        ${item.crop} 
                        <small style="color: var(--color-text);">Optimum Range: N(${item.npkRange.N.join('-')}) P(${item.npkRange.P.join('-')}) K(${item.npkRange.K.join('-')}) pH(${item.npkRange.pH.join('-')})</small></li>`;
                });
                resultsHTML += `</ul>`;

                if (compatibleMatches.length > 0) {
                    resultsHTML += `<p class="result-title" style="margin-top: 30px; font-size: 1.4em; color: var(--color-primary); border-bottom: 1px solid var(--color-primary);"><i class="fas fa-list-alt"></i> Secondary Recommendations:</p>`;
                    resultsHTML += `<ul class="crop-list" style="list-style: none; padding: 0;">`;
                    compatibleMatches.forEach(item => {
                         resultsHTML += `<li class="crop-item" style="border-left-color: var(--color-secondary); padding: 15px; border-radius: 8px; margin-bottom: 10px; background-color: rgba(0, 255, 127, 0.05);">
                            ${item.crop} (Confidence: ${item.score}/4)
                            <small style="color: var(--color-text);">Optimum Range: N(${item.npkRange.N.join('-')}) P(${item.npkRange.P.join('-')}) K(${item.npkRange.K.join('-')}) pH(${item.npkRange.pH.join('-')})</small></li>`;
                    });
                    resultsHTML += `</ul>`;
                }

                resultsHTML += `<div class="compatibility-note" style="margin-top: 20px;">This report is generated by the AI Model.</div>`;

            } else {
                resultsHTML += `<p class="result-title" style="color: var(--color-accent); text-shadow: none;"><i class="fas fa-exclamation-circle"></i> LOW SUITABILITY PROFILE</p>
                    <div class="compatibility-note" style="color: var(--color-text);">The current soil profile (N:${N}, P:${P}, K:${K}, pH:${pH}) is highly non-optimal. 
                    <br><strong style="color: var(--color-accent);">Immediate Intervention:</strong> Dynamic nutrient adjustment is required.</div>`;
            }

            resultsDiv.innerHTML = resultsHTML;

            // --- ADVANCED VISUALIZATION UPDATE ---
            updateGauge(maxScore);
            
            // 3D molecule update removed
        }
        
        // =================================================================
        // SIMULATION FUNCTIONS FOR OTHER MODULES
        // =================================================================

        // 1. Pest Detection Simulation
        function processImage() {
            const status = document.getElementById('log-status');
            const severity = document.getElementById('log-severity');
            const treatment = document.getElementById('log-treatment');
            
            status.textContent = "Processing image via CVN-1...";
            severity.textContent = "Analyzing...";
            treatment.textContent = "Calculating...";
            
            setTimeout(() => {
                const results = [
                    { status: "IDENTIFIED: Early Blight (Alternaria solani)", severity: "Moderate (35% coverage)", treatment: "Apply Chlorothalonil fungicide. Isolate affected plants." },
                    { status: "IDENTIFIED: Aphid Infestation", severity: "Low (5% leaf damage)", treatment: "Use Neem oil spray or introduce natural predators." },
                    { status: "IDENTIFIED: Iron Deficiency", severity: "High (Chlorosis evident)", treatment: "Apply chelated Iron (Fe) supplement to the root zone." }
                ];
                const result = results[Math.floor(Math.random() * results.length)];
                
                status.innerHTML = `<span style="color: var(--color-secondary);">${result.status}</span>`;
                severity.innerHTML = `<span style="color: var(--color-warning);">${result.severity}</span>`;
                treatment.innerHTML = `<span style="color: var(--color-primary);">${result.treatment}</span>`;
            }, 2500);
        }

        // 2. Chat/Voice Simulation
        function simulateAIResponse(userMessage) {
            const chatWindow = document.getElementById('chat-window');
            const responses = [
                "I detect an NPK imbalance. Please use a 10-20-20 fertilizer mix immediately.",
                "The weather forecast shows high humidity. Watch for fungal outbreaks on your tomato plants.",
                "The market price for your Wheat crop has increased by 1.2% today due to reduced global supply.",
                "I suggest adjusting your irrigation schedule by 15 minutes less per cycle for water efficiency."
            ];
            const aiResponse = responses[Math.floor(Math.random() * responses.length)];

            setTimeout(() => {
                chatWindow.innerHTML += `<div class="chat-message ai-msg">${aiResponse}</div>`;
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }, 1000);
        }

        function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (message === "") return;

            const chatWindow = document.getElementById('chat-window');
            
            // Display user message
            chatWindow.innerHTML += `<div class="chat-message user-msg">${message}</div>`;
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            // Simulate AI response
            simulateAIResponse(message);
            
            input.value = "";
        }

        function simulateVoiceInput() {
            const input = document.getElementById('user-input');
            const chatWindow = document.getElementById('chat-window');
            
            const randomVoiceQuery = [
                "‡§Æ‡•á‡§∞‡•Ä ‡§´‡§∏‡§≤ ‡§Æ‡•á‡§Ç ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç, ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡•Ç‡§Å?", // Hindi
                "‡∞®‡∞æ ‡∞™‡∞§‡±ç‡∞§‡∞ø ‡∞™‡∞Ç‡∞ü‡∞ï‡±Å ‡∞™‡±Å‡∞∞‡±Å‡∞ó‡±Å ‡∞Æ‡∞Ç‡∞¶‡±Å ‡∞è‡∞Æ‡∞ø ‡∞µ‡∞æ‡∞°‡∞æ‡∞≤‡∞ø?", // Telugu
                "Why is my soil pH low?",
                "What is the best time to harvest maize?"
            ];
            
            const simulatedMessage = randomVoiceQuery[Math.floor(Math.random() * randomVoiceQuery.length)];
            
            chatWindow.innerHTML += `<div class="chat-message user-msg"><i class="fas fa-microphone" style="margin-right: 5px;"></i> (Voice Input) ${simulatedMessage}</div>`;
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            // Simulate AI response
            simulateAIResponse(simulatedMessage);
        }

        
        window.addEventListener('load', function() {
            // Hide loading screen after a short delay
            setTimeout(() => {
                const loadingOverlay = document.getElementById('loading-overlay');
                loadingOverlay.style.opacity = 0;
                setTimeout(() => loadingOverlay.style.display = 'none', 1000);
            }, 500); 

            // Start simulated terminal feed
            startTerminalFeed();
            
            // Set initial navigation state
            handleNavigation();

            const sidebar = document.querySelector('#page-advisory .content-grid > section:last-child');
            if (window.matchMedia('(min-width: 900px)').matches && sidebar) {
                sidebar.style.position = 'sticky';
                sidebar.style.top = 'calc(var(--header-height) + 20px)'; 
            }
            updateGauge(0); // Initialize gauge to 0
        });
    </script>
</body>
</html>
